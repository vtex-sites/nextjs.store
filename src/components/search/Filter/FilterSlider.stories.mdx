import { SearchProvider, SessionProvider } from '@faststore/sdk'
import { useSearch } from '@faststore/sdk'

import storeConfig from 'store.config'

import UIProvider, { useUI } from 'src/sdk/ui/Provider'
import { validateSession } from 'src/sdk/session/validate'
import { useFilter } from './useFilter'

import Button from 'src/components/ui/Button'
import Icon from 'src/components/ui/Icon'
import FilterSlider from './FilterSlider'

import { facets as facetsMock } from 'src/../.storybook/mocks/filter-slider'

import { Meta, Canvas, Story, ArgsTable } from '@storybook/addon-docs'

import {
  TokenTable,
  TokenRow,
  TokenDivider,
} from 'src/../.storybook/components'

<Meta
  title="Organisms/Filter/FilterSlider"
  component={FilterSlider}
  argTypes={{
    testId: {
      table: {
        disable: true,
      },
    },
    selected: {
      description: 'The selected facets.',
    },
    expanded: {
      description: 'An array of the expanded Accordion indexes from Facets.',
    },
    dispatch: {
      description: 'The dispatch function from useUI() hook.',
    },
  }}
/>

export const FilterTemplate = (args) => {
  const filter = useFilter(args.facets)
  const { state, setState } = useSearch()
  const { filter: displayFilter, openFilter } = useUI()
  const { facets, expanded, dispatch } = filter
  return (
    <>
      <Button
        variant="tertiary"
        icon={<Icon name="FadersHorizontal" width={16} height={16} />}
        iconPosition="left"
        aria-label="Open Filters"
        onClick={openFilter}
      >
        Open Filters
      </Button>
      {displayFilter && <FilterSlider {...filter} />}
    </>
  )
}

export const TemplateWithProvider = (args) => {
  return (
    <SessionProvider
      initialstate={{
        channel: storeConfig.channel,
      }}
    >
      <UIProvider>
        <SearchProvider onChange={() => ({})}>
          <FilterTemplate {...args} />
        </SearchProvider>
      </UIProvider>
    </SessionProvider>
  )
}

<header>

# FilterSlider

The mobile `Filter` view that is rendered inside a `SlideOver` component.

</header>

## Overview

The `FilterSlider` component uses the `SlideOver`, and `Facets` components.

<Canvas>
  <Story
    name="overview-default"
    args={{
      facets: facetsMock,
    }}
  >
    {TemplateWithProvider.bind({})}
  </Story>
</Canvas>

---

## Usage

`import { FilterSlider } from 'src/components/search/Filter'`

<Canvas>
  <Story
    name="default"
    args={{
      facets: facetsMock,
    }}
  >
    {TemplateWithProvider.bind({})}
  </Story>
</Canvas>

<ArgsTable story="default" />

---

## Nested Elements

### Content

<TokenTable>
  <TokenRow
    token="--fs-filter-slider-content-height"
    value="calc(100vh - var(--fs-filter-slider-footer-height))"
  />
  <TokenRow
    token="--fs-filter-slider-content-padding"
    value="var(--fs-spacing-3) var(--fs-spacing-3) calc(var(--fs-filter-slider-footer-height) + var(--fs-spacing-3))"
  />
</TokenTable>

### Header

<TokenTable>
  <TokenRow
    token="--fs-filter-slider-header-icon-margin-right"
    value="calc(-1 * var(--fs-spacing-1))"
  />
</TokenTable>

### Footer

<TokenTable>
  <TokenRow token="--fs-filter-slider-footer-width" value="100%" />
  <TokenRow token="--fs-filter-slider-footer-height" value="5rem" />
  <TokenDivider />
  <TokenRow
    token="--fs-filter-slider-footer-padding"
    value="var(--fs-spacing-3)"
  />
  <TokenDivider />
  <TokenRow
    token="--fs-filter-slider-footer-bkg-color"
    value="var(--fs-color-neutral-0)"
    isColor
  />
  <TokenRow
    token="--fs-filter-slider-footer-box-shadow"
    value="0 0 6px rgb(0 0 0 / 20%)"
  />
</TokenTable>

### Footer Buttons

<TokenTable>
  <TokenRow token="--fs-filter-slider-footer-button-clear-width" value="40%" />
  <TokenRow
    token="--fs-filter-slider-footer-button-clear-margin-right"
    value="var(--fs-spacing-3)"
  />
  <TokenDivider />
  <TokenRow token="--fs-filter-slider-footer-button-apply-width" value="60%" />
</TokenTable>
